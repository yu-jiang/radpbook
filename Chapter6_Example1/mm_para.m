Params.omg0 = 314.159; %steady state frequency
Params.Nm = 10;        %# of machines

H = [100    6.4   3   5.5      5.2    4.7   5.4     4.9     5.1     3.4];
D = [0     1      1.5      2      2.2       2.3     2.6     1.8     1.7    2.9];
T = [0     6      6.3    4.9      6.6      5.8    5.9    5.5    5.4   5.5];
E = [1     1.2      1.5    .8      1.3      0.9    1.1    .6    1.5   1];
Params.dlt0 = [0   1.9    1.7    1      1.2      1.3    .8    1.2     .7   1.1]';

imxx = (Nm-1)*3 + 1 + (0:(Nm-2))*12;
imuu = imxx+9;

Params.BX = [0.2537    0.1875    0.0132    0.2967    0.2852    0.4848    0.2443    0.0908    0.2149    0.2335
    0.1875    0.3927    0.2493    0.5291    0.2827    0.2909    0.3759    0.3272    0.2354    0.3819
    0.0132    0.2493    0.0545    0.2712    0.2465    0.2230    0.2741    0.2147    0.3280    0.4937
    0.2967    0.5291    0.2712    0.5746    0.3255    0.3301    0.1325    0.2878    0.4921    0.1255
    0.2852    0.2827    0.2465    0.3255    0.2067    0.3724    0.3049    0.0294    0.2433    0.3146
    0.4848    0.2909    0.2230    0.3301    0.3724    0.4621    0.2790    0.4083    0.3542    0.1356
    0.2443    0.3759    0.2741    0.1325    0.3049    0.2790    0.1151    0.4265    0.1437    0.5278
    0.0908    0.3272    0.2147    0.2878    0.0294    0.4083    0.4265    0.3280    0.1635    0.4432
    0.2149    0.2354    0.3280    0.4921    0.2433    0.3542    0.1437    0.1635    0.3644    0.2120
    0.2335    0.3819    0.4937    0.1255    0.3146    0.1356    0.5278    0.4432    0.2120    0.3681];

Params.GX=[2.1043    0.5194    0.0047    1.3971    0.4052   -0.1143    0.0088    2.8105   -0.7849   -0.0019
    0.5194    2.9397    0.3410    0.1829    1.2937   -1.7493   -0.0346   -0.0512   -1.0858   -0.3718
    0.0047    0.3410    1.5196    1.7842   -2.6536   -0.9942    1.5418   -0.4936    2.2536    2.7643
    1.3971    0.1829    1.7842    0.4805   -1.1049   -0.7318    2.2099   -1.1210    2.3378   -1.4679
    0.4052    1.2937   -2.6536   -1.1049    0.8255   -2.0058   -0.7204   -1.9231    0.3224   -1.4969
    -0.1143   -1.7493   -0.9942   -0.7318   -2.0058    0.2316   -0.2891    0.3602    1.1842   -0.6656
    0.0088   -0.0346    1.5418    2.2099   -0.7204   -0.2891    0.3899    0.6421    0.6078   -0.9809
    2.8105   -0.0512   -0.4936   -1.1210   -1.9231    0.3602    0.6421    2.6875    1.3337    1.1306
    -0.7849   -1.0858    2.2536    2.3378    0.3224    1.1842    0.6078    1.3337    1.9344   -1.7285
    -0.0019   -0.3718    2.7643   -1.4679   -1.4969   -0.6656   -0.9809    1.1306   -1.7285    2.0532];

GX = GX*0.1;

A = zeros(3,3,Nm);
B = zeros(3,1,Nm);

K00 = [1 1.5 20];

Kstar=K00;
pm=0;
for i=2:Nm
    A(:,:,i)=[0 1 0; 0 -D(i)/2/H(i) omg0/2/H(i);  0 0 -1/T(i)];
    B(:,:,i)=[0;0;1/T(i)];
    pm(i)=E(i)*(E.*BX(i,:)*sin(dlt0(i)-dlt0)+E.*GX(i,:)*cos(dlt0(i)-dlt0));
    Kstar(:,:,i-1)=lqr(A(:,:,i),B(:,:,i),1000*eye(3),1);
end